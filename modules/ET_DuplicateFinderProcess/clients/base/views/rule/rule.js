({extendsFrom:"BaseView",rule:{},ruleIndex:"",eontekFields:{},eontekModuleBean:null,operationLabels:{$equals_value:"LBL_OPERATOR_EQUALS_VALUE",$equals:"LBL_OPERATOR_EQUALS",$not_equals:"LBL_OPERATOR_NOT_EQUALS",$lt:"LBL_OPERATOR_LESS_THAN",$lte:"LBL_OPERATOR_LESS_THAN_OR_EQUALS",$gt:"LBL_OPERATOR_GREATER_THAN",$gte:"LBL_OPERATOR_GREATER_THAN_OR_EQUALS",$starts:"LBL_OPERATOR_STARTS_WITH",$ends:"LBL_OPERATOR_ENDS_WITH",$contains:"LBL_OPERATOR_CONTAINS"},operationsFields:{$equals_value:{renderField:!0,
  fieldType:"selectedField"},$equals:{renderField:!1},$not_equals:{renderField:!1},$starts:{renderField:!0,fieldType:"text"},$ends:{renderField:!0,fieldType:"text"},$contains:{renderField:!0,fieldType:"text"},$lt:{renderField:!0,fieldType:"datetimecombo"},$lte:{renderField:!0,fieldType:"datetimecombo"},$gt:{renderField:!0,fieldType:"datetimecombo"},$gte:{renderField:!0,fieldType:"datetimecombo"}},restrictedFieldTypes:["tag","link","id","teamset"],initialize:function(a){this.rule={};this.ruleIndex="";
  this.eontekFields={};this.ruleIndex=a.meta.ruleIndex;this.rule=a.meta.rule;this.eontekModuleBean=app.data.createBean(this.rule.eontek_module_name,{});this._super("initialize",[a]);a=$("<div>",{"class":"row-fluid rule-row","data-rule-id":this.ruleIndex});this.setElement(a)},render:function(){this._super("render");this.renderInitialFields()},availableOperations:function(a){switch(a){case "bool":a=["$equals"];break;case "int":case "currency":a=["$equals"];break;case "email":case "phone":case "varchar":case "name":case "fullname":case "assigned_user_name":case "text":a=
    ["$equals"];break;case "date":case "datetime":a=["$equals"];break;case "enum":a=["$equals"];break;case "relate":a=["$equals"];break;default:a=["$equals"]}return a},getOperationsWithLabels:function(a){var b=this;a=b.availableOperations(a);var c={};$.each(a,function(a,d){c[d]=app.lang.get(b.operationLabels[d],"ET_DuplicateFinderProcess")});return c},getFieldsWithLabels:function(){var a=this,b=app.data.createBean(a.rule.eontek_module_name,{}),c={};$.each(b.fields,function(b,d){if(-1==$.inArray(d.type,
        a.restrictedFieldTypes)&&"id"!==d.dbType){if(-1!=$.inArray(d.name,["email"]))return!0;var e=app.lang.get(d.vname,a.rule.eontek_module_name)+" ("+d.name+")";"undefined"!=typeof e&&(c[b]=e)}});return c},renderInitialFields:function(){var a=this;_.isEmpty(this.rule)||$.each(a.rule,function(b,c){var f=app.data.createBean(a.rule.eontek_module_name,{}),d;d="object"!=typeof a.rule.eontek_field?""!==a.rule.eontek_field?f.fields[a.rule.eontek_field].type:null:""!==a.rule.eontek_field?f.fields[a.rule.eontek_field.fieldName].type:
    null;switch(b){case "eontek_module_name":var e="eontek_module_name";a.eontekModuleBean.set(e,c);var g={},f=app.metadata.getModuleNames({filter:["enabled","visible","display_tab"]});$.each(f,function(a,b){_.contains(["Home","Calendar","Reports","Emails"],b)||(g[b]=app.lang.getModuleName(b,{plural:!0}))});a.createField("module","enum",e,"LBL_EONTEK_MODEL",g);a.eontekFields.module.setDisabled();break;case "eontek_field":e="eontek_field_"+a.ruleIndex;"object"==typeof a.rule.eontek_field?a.eontekModuleBean.set(e,
    c.fieldName):a.eontekModuleBean.set(e,c);a.eontekModuleBean.on("change:"+e,a.fieldValueChanged,a);a.createField("field","enum",e,"LBL_EONTEK_FIELD",a.getFieldsWithLabels());break;case "eontek_operation":e="eontek_operation_"+a.ruleIndex;a.eontekModuleBean.set(e,c);a.eontekModuleBean.on("change:"+e,a.operationValueChanged,a);g=null!=d?a.getOperationsWithLabels(d):{"":""};a.createField("operation","enum",e,"LBL_EONTEK_OPERATION",g);null==d&&a.eontekFields.operation.setDisabled();break;case "eontek_value":""!=
a.rule.eontek_operation&&1==a.operationsFields[a.rule.eontek_operation].renderField&&("selectedField"==a.operationsFields[a.rule.eontek_operation].fieldType?("object"==typeof a.rule.eontek_field?(e=a.rule.eontek_field.fieldName,a.eontekModuleBean.set(e,c.valueName),a.eontekModuleBean.set(a.rule.eontek_field.fieldId,c.valueId)):(e=a.rule.eontek_field,a.eontekModuleBean.set(e,c)),d=null!==d?d:"text","enum"==d?a.createField("value",d,e,"LBL_EONTEK_VALUE",f.fields[a.rule.eontek_field].options):a.createField("value",
    d,e,"LBL_EONTEK_VALUE")):(d=a.operationsFields[a.rule.eontek_operation].fieldType,e=a.rule.eontek_field,a.eontekModuleBean.set(e,c),a.createField("value",d,e,"LBL_EONTEK_VALUE")))}})},createField:function(a,b,c,f,d){b="enum"==b?app.view.createField({view:this,model:this.eontekModuleBean,def:{type:b,name:c,label:f,options:d}}):app.view.createField({view:this,model:this.eontekModuleBean,def:{type:"datetime"==b?"datetimecombo":b,name:c,label:f}});this.$(".rule-"+a).html(b.$el);b.setMode("edit");b.render();
  this.eontekFields[a]=b},fieldValueChanged:function(a){a=a.changed[Object.keys(a.changed)[0]];a=this.getOperationsWithLabels(this.eontekModuleBean.fields[a].type);this.eontekFields.operation.items=a;this.eontekModuleBean.set("eontek_operation_"+this.ruleIndex,"");this.eontekFields.operation.setDisabled(!1);this.eontekFields.operation.render();null!=this.eontekFields.value&&(this.eontekFields.value.remove(),delete this.eontekFields.value)},operationValueChanged:function(a){var b=this.eontekModuleBean.get("eontek_operation_"+
    this.ruleIndex);""!=b&&(a=this.eontekModuleBean.get("eontek_field_"+this.ruleIndex),this.eontekModuleBean.set(a,""),1==this.operationsFields[b].renderField?("selectedField"==this.operationsFields[b].fieldType?(b=this.eontekModuleBean.fields[this.eontekModuleBean.get("eontek_field_"+this.ruleIndex)].type,"enum"==b?this.createField("value",b,a,"LBL_EONTEK_VALUE",this.eontekModuleBean.fields[a].options):this.createField("value",b,a,"LBL_EONTEK_VALUE")):(b=this.operationsFields[b].fieldType,this.createField("value",
    b,a,"LBL_EONTEK_VALUE")),this.eontekFields.value.render()):null!=this.eontekFields.value&&(this.eontekFields.value.remove(),delete this.eontekFields.value))},getRuleValues:function(){var a=this.eontekModuleBean.get("eontek_field_"+this.ruleIndex),b=this.eontekModuleBean.get("eontek_operation_"+this.ruleIndex);this.eontekModuleBean.get("eontek_module_name");var c=this.eontekModuleBean.get(a);if(""==a||"undefined"==typeof a||""==b||"undefined"==typeof b)return this.$el.addClass("rule-invalid"),!1;if(1==
    this.operationsFields[b].renderField){if(!0===this.eontekFields.value.model.fields[a].hasOwnProperty("id_name")&&(a=this.eontekFields.value.model.fields[a].id_name,c=this.eontekFields.value.model.get(a)),""==c||"undefined"==typeof c||""==a||"undefined"==typeof a)return this.$el.addClass("rule-invalid"),!1}else c="$"+a;this.$el.addClass("rule-valid");var f={};f[a]={};f[a][b]=c;return f}});